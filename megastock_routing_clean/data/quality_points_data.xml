<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- ========== PUNTOS DE CONTROL DE CALIDAD MEGASTOCK ========== -->
        
        <!-- ========== TIPOS DE CONTROLES DE CALIDAD ========== -->
        
        <!-- Tipo de Test: Dimensional -->
        <record id="quality_test_type_dimensional" model="quality.point.test.type">
            <field name="name">Control Dimensional</field>
            <field name="technical_name">dimensional</field>
            <field name="active">True</field>
        </record>
        
        <!-- Tipo de Test: Visual -->
        <record id="quality_test_type_visual" model="quality.point.test_type">
            <field name="name">Inspección Visual</field>
            <field name="technical_name">visual</field>
            <field name="active">True</field>
        </record>
        
        <!-- Tipo de Test: Resistencia -->
        <record id="quality_test_type_strength" model="quality.point.test_type">
            <field name="name">Test de Resistencia</field>
            <field name="technical_name">strength</field>
            <field name="active">True</field>
        </record>
        
        <!-- Tipo de Test: Adhesión -->
        <record id="quality_test_type_adhesion" model="quality.point.test_type">
            <field name="name">Test de Adhesión</field>
            <field name="technical_name">adhesion</field>
            <field name="active">True</field>
        </record>
        
        <!-- ========== PUNTOS DE CONTROL: CAJAS CORRUGADAS ========== -->
        
        <!-- Control 1: Verificación Post-Impresión -->
        <record id="quality_point_post_printing" model="quality.point">
            <field name="title">Control Post-Impresión</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_fefco_0201_30x20x15'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_cajas_std_010_preprinter"/>
            <field name="test_type_id" ref="quality_test_type_visual"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">1</field>  <!-- 1 control por lote -->
            <field name="measure_frequency_type">all</field>
            <field name="active">True</field>
            <field name="note">
Verificación post-impresión flexográfica:
- Registro de colores correcto
- Densidad de tinta uniforme  
- Ausencia de manchas o rayas
- Legibilidad de textos
- Correspondencia con muestra aprobada
            </field>
        </record>
        
        <!-- Control 2: Verificación Post-Corrugado -->
        <record id="quality_point_post_corrugating" model="quality.point">
            <field name="title">Control Post-Corrugado</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_fefco_0201_30x20x15'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_cajas_std_020_corrugadora"/>
            <field name="test_type_id" ref="quality_test_type_adhesion"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">2</field>  <!-- 2 controles por lote -->
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Verificación post-corrugado:
- Adherencia correcta entre capas
- Altura de flauta uniforme (4mm ±0.2)
- Ausencia de delaminación
- Planitud del cartón (max 2mm/m)
- Test de delaminación por tracción
            </field>
        </record>
        
        <!-- Control 3: Control Dimensional Post-Troquelado -->
        <record id="quality_point_post_die_cutting" model="quality.point">
            <field name="title">Control Dimensional Post-Troquelado</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_fefco_0201_30x20x15'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_cajas_std_030_troqueladora"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">3</field>  <!-- 3 controles por lote -->
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Control dimensional post-troquelado:
- Dimensiones desarrollo: 30±1 x 20±1 cm
- Líneas de doblez correctas (sin fisuras)
- Perforaciones limpias sin rebabas
- Verificación plantilla FEFCO 0201
- Ángulos de 90° ±2°
            </field>
        </record>
        
        <!-- Control 4: Test de Resistencia BCT -->
        <record id="quality_point_bct_test" model="quality.point">
            <field name="title">Test de Resistencia BCT</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_fefco_0201_30x20x15'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_cajas_std_040_control_calidad"/>
            <field name="test_type_id" ref="quality_test_type_strength"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">1</field>  <!-- 1 test por lote -->
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Test de resistencia al aplastamiento (BCT):
- Resistencia mínima: 180 kg
- Acondicionamiento: 23°C, 50% HR, 24h
- Velocidad de carga: 12.5 mm/min
- Criterio aceptación: >180 kg
- Registro automático en sistema
            </field>
        </record>
        
        <!-- ========== PUNTOS DE CONTROL: LÁMINAS CORRUGADAS ========== -->
        
        <!-- Control 1: Planitud de Láminas -->
        <record id="quality_point_lamina_flatness" model="quality.point">
            <field name="title">Control de Planitud Láminas</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_lamina_corrugada_70x50'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_laminas_010_corrugadora"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">2</field>
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Control de planitud láminas corrugadas:
- Máxima deformación: 3mm en 70cm
- Medición con regla de precisión
- Verificar ausencia de ondulaciones
- Control de humedad relativa
            </field>
        </record>
        
        <!-- Control 2: Dimensiones Corte Guillotina -->
        <record id="quality_point_lamina_cutting" model="quality.point">
            <field name="title">Control Corte Guillotina</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_lamina_corrugada_70x50'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_laminas_020_guillotina"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">1</field>
            <field name="measure_frequency_type">all</field>
            <field name="active">True</field>
            <field name="note">
Control dimensional corte guillotina:
- Dimensiones: 70±0.5 x 50±0.5 cm
- Ángulos de corte: 90° ±1°
- Bordes limpios sin rebabas
- Verificación calibre automático
            </field>
        </record>
        
        <!-- ========== PUNTOS DE CONTROL: MICROCORRUGADO ========== -->
        
        <!-- Control 1: Registro de Impresión Alta Calidad -->
        <record id="quality_point_micro_printing_register" model="quality.point">
            <field name="title">Control Registro Impresión Microcorrugado</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_micro_cosmetica'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_micro_010_preprinter"/>
            <field name="test_type_id" ref="quality_test_type_visual"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">1</field>
            <field name="measure_frequency_type">all</field>
            <field name="active">True</field>
            <field name="note">
Control registro impresión microcorrugado:
- Registro CMYK: ±0.2mm máximo
- Densidad color uniforme por Pantone
- Resolución mínima: 150 lpi
- Verificación lupa cuenta hilos 10x
- Correspondencia muestra aprobada
            </field>
        </record>
        
        <!-- Control 2: Espesor Microcorrugado -->
        <record id="quality_point_micro_thickness" model="quality.point">
            <field name="title">Control Espesor Microcorrugado</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_micro_cosmetica'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_micro_020_microcorrugadora"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">3</field>
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Control espesor microcorrugado:
- Espesor nominal: 1.5mm ±0.1mm
- Medición micrómetro digital
- 5 puntos por muestra
- Flauta tipo E uniforme
- Adhesión PVA sin defectos
            </field>
        </record>
        
        <!-- Control 3: Precisión Troquelado Micro -->
        <record id="quality_point_micro_die_cutting_precision" model="quality.point">
            <field name="title">Control Precisión Troquelado Micro</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_caja_micro_cosmetica'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_micro_030_troqueladora"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">5</field>  <!-- Mayor control por precisión -->
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Control precisión troquelado microcorrugado:
- Tolerancia dimensional: ±0.3mm
- Líneas de doblez sin fisuras
- Perforaciones limpias
- Verificación calibre pasa/no pasa
- Control 100% dimensional crítico
            </field>
        </record>
        
        <!-- ========== PUNTOS DE CONTROL: PAPEL PERIÓDICO ========== -->
        
        <!-- Control 1: Gramaje Papel Periódico -->
        <record id="quality_point_newspaper_weight" model="quality.point">
            <field name="title">Control Gramaje Papel Periódico</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_papel_periodico_resma'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_periodico_010_convertidor"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">1</field>
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Control gramaje papel periódico:
- Gramaje nominal: 45 g/m² ±2
- Muestreo 10 hojas por resma
- Balanza precisión 0.1g
- Cálculo automático gramaje
- Registro en sistema calidad
            </field>
        </record>
        
        <!-- Control 2: Conteo Hojas por Resma -->
        <record id="quality_point_newspaper_count" model="quality.point">
            <field name="title">Control Conteo Hojas</field>
            <field name="product_ids" eval="[(4, ref('megastock_products.product_papel_periodico_resma'))]"/>
            <field name="picking_type_ids" eval="[(4, ref('mrp.picking_type_mrp_operation'))]"/>
            <field name="operation_id" ref="routing_op_periodico_020_empaque"/>
            <field name="test_type_id" ref="quality_test_type_dimensional"/>
            <field name="team_id" ref="quality_control.quality_team_0"/>
            <field name="company_id" ref="base.main_company"/>
            <field name="control_per_lot">3</field>  <!-- 3 resmas por lote -->
            <field name="measure_frequency_type">random</field>
            <field name="active">True</field>
            <field name="note">
Control conteo hojas por resma:
- Conteo exacto: 500 hojas/resma
- Verificación 3 resmas por lote
- Tolerancia: ±2 hojas máximo
- Control espesor total resma
- Registro automático contador
            </field>
        </record>
        
        <!-- ========== CONFIGURACIÓN DE ALERTAS DE CALIDAD ========== -->
        
        <!-- Alerta por Fallas Recurrentes -->
        <record id="quality_alert_recurring_failures" model="ir.cron">
            <field name="name">Alerta Fallas Recurrentes de Calidad</field>
            <field name="model_id" ref="quality_control.model_quality_check"/>
            <field name="state">code</field>
            <field name="code">
# Detectar fallas recurrentes en controles de calidad
from datetime import datetime, timedelta
import logging
_logger = logging.getLogger(__name__)

# Buscar fallas en los últimos 7 días
week_ago = datetime.now() - timedelta(days=7)
failed_checks = env['quality.check'].search([
    ('test_date', '>=', week_ago),
    ('quality_state', '=', 'fail')
])

# Agrupar por punto de control
failure_count = {}
for check in failed_checks:
    point_name = check.point_id.title
    if point_name not in failure_count:
        failure_count[point_name] = 0
    failure_count[point_name] += 1

# Alertar si más de 3 fallas en mismo punto
for point, count in failure_count.items():
    if count >= 3:
        _logger.warning(f"ALERTA CALIDAD: {count} fallas en {point} esta semana")
        # Aquí se puede enviar notificación
            </field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="active">True</field>
        </record>
        
        <!-- ========== CONFIGURACIÓN DE EQUIPOS DE MEDICIÓN ========== -->
        
        <!-- Equipo: Micrómetro Digital -->
        <record id="measuring_equipment_micrometer" model="maintenance.equipment">
            <field name="name">Micrómetro Digital Mitutoyo 0-25mm</field>
            <field name="equipment_type">equipment</field>
            <field name="category_id" ref="maintenance.equipment_category_1"/>
            <field name="model">Mitutoyo 293-240-30</field>
            <field name="serial_no">MICRO-MIT-2024-001</field>
            <field name="location">Laboratorio Calidad</field>
            <field name="assign_date">2024-01-15</field>
            <field name="warranty_date">2026-01-15</field>
            <field name="maintenance_duration">1.0</field>
            <field name="note">
Micrómetro digital para control espesor
- Rango: 0-25mm
- Resolución: 0.001mm
- Calibración anual requerida
- Certificado trazabilidad INEN
            </field>
        </record>
        
        <!-- Equipo: Balanza de Precisión -->
        <record id="measuring_equipment_precision_scale" model="maintenance.equipment">
            <field name="name">Balanza Precisión Mettler Toledo 0.1g</field>
            <field name="equipment_type">equipment</field>
            <field name="category_id" ref="maintenance.equipment_category_1"/>
            <field name="model">Mettler Toledo ME204</field>
            <field name="serial_no">SCALE-MET-2024-001</field>
            <field name="location">Laboratorio Calidad</field>
            <field name="assign_date">2024-02-01</field>
            <field name="warranty_date">2027-02-01</field>
            <field name="maintenance_duration">0.5</field>
            <field name="note">
Balanza de precisión para gramajes
- Capacidad: 220g
- Resolución: 0.1mg
- Calibración mensual interna
- Verificación anual externa
            </field>
        </record>
        
        <!-- Equipo: Equipo BCT -->
        <record id="measuring_equipment_bct_tester" model="maintenance.equipment">
            <field name="name">Equipo Test BCT Compresión Cajas</field>
            <field name="equipment_type">equipment</field>
            <field name="category_id" ref="maintenance.equipment_category_1"/>
            <field name="model">Regmed RGM-BCT-500</field>
            <field name="serial_no">BCT-RGM-2024-001</field>
            <field name="location">Laboratorio Calidad</field>
            <field name="assign_date">2024-03-01</field>
            <field name="warranty_date">2029-03-01</field>
            <field name="maintenance_duration">4.0</field>
            <field name="note">
Equipo test compresión cajas BCT
- Capacidad: 500 kg
- Velocidad: 12.5 mm/min
- Control climatizado
- Certificación anual requerida
            </field>
        </record>
        
    </data>
</odoo>